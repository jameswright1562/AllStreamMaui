@using AllStream.Shared.Models.CDN
<div class="grid gap-4">
    @if (Match is not null)
    {
        <div class="flex items-center gap-3 justify-center">
            <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-md text-white transition-colors cursor-pointer" @onclick="OnBack">‚Üê Back</button>
            <h3 class="m-0 text-xl font-bold">@Match.HomeTeam VS @Match.AwayTeam</h3>
        </div>
        <div class="flex gap-3 overflow-x-auto pb-2 snap-x snap-mandatory touch-pan-x" role="list">
            @foreach (var channel in Match.Channels)
            {
                <button class="flex items-center gap-2.5 px-3 py-2 rounded-xl border border-white/15 bg-black/25 text-inherit cursor-pointer snap-start min-w-[220px] transition-colors hover:bg-black/40 @(SelectedChannel == channel ? "border-green-500 ring-1 ring-green-500/25" : "")" role="listitem" @onclick="(() => SelectedChannel = channel)">
                    <img class="w-[72px] h-[72px] object-contain bg-white/5 border border-white/10 rounded-lg" src="@channel.Image" alt="@channel.Name" />
                    <span class="font-semibold">@channel.Name</span>
                </button>
            }
        </div>
    }

    <div class="rounded-xl overflow-hidden border border-white/10 bg-black/40 aspect-video">
        @if (SelectedChannel is not null && !string.IsNullOrWhiteSpace(SelectedChannel.Url))
        {
            <iframe class="w-full h-full border-0 block"
                    src=@SelectedChannel.Url
                    allow="encrypted-media; fullscreen"
                    allowfullscreen>
            </iframe>
        }
        else
        {
            <div class="flex items-center justify-center h-full text-gray-400">Select a channel above to play</div>
        }
    </div>
</div>

@code {
    [Parameter] 
    public SportResponse Match { get; set; }
    [Parameter]
    public EventCallback OnBack { get; set; }
    
    Channels? SelectedChannel; 

    protected override async Task OnParametersSetAsync()
    {
        SelectedChannel = Match?.Channels?.FirstOrDefault();
    }

}
